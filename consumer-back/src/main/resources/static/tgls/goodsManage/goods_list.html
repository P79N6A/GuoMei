<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1">
    <!-- Google Chrome Frame也可以让IE用上Chrome的引擎: -->
    <meta name="renderer" content="webkit">
    <!--国产浏览器高速模式-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 定义页面的最新版本 -->
    <meta name="description" content="网站简介"/>

    <!-- 公共样式 开始 -->
    <link rel="stylesheet" type="text/css" href="../../css/base.css">
    <link rel="stylesheet" type="text/css" href="../../css/iconfont.css">
    <script type="text/javascript" src="../../framework/jquery-1.11.3.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../../layui/css/layui.css">
    <script type="text/javascript" src="../../layui/layui.js"></script>
    <!-- 滚动条插件 -->
    <link rel="stylesheet" type="text/css" href="../../css/jquery.mCustomScrollbar.css">
    <script src="../../framework/jquery-ui-1.10.4.min.js"></script>
    <script src="../../framework/jquery.mousewheel.min.js"></script>
    <script src="../../framework/jquery.mCustomScrollbar.min.js"></script>
    <script src="../../framework/cframe.js"></script><!-- 仅供所有子页面使用 -->
    <!-- 公共样式 结束 -->
    <style type="text/css">

        .layui-table-cell {
            height: auto !important;
            white-space: normal;
        }

        .layui-table img {
            max-height: 25px
        }

    </style>

</head>

<body>
<div class="cBody">
    <div class="console">
        <form class="layui-form" action="">
            <div class="layui-form-item">
                <div class="layui-input-inline">
                    <input type="text" name="name" required lay-verify="required" placeholder="输入商品名称"
                           autocomplete="off" class="layui-input">
                </div>
                <div class="layui-input-inline">
                    <select name="provid" id="provid" lay-filter="provid">
                        <option value="">一级分类</option>
                    </select>
                </div>
                <button class="layui-btn" lay-submit lay-filter="formDemo">检索</button>
                <a class="layui-btn">导入商品</a>
            </div>
        </form>
    </div>
    <script type="text/html" id="barDemo">
        <a class="layui-btn layui-btn-xs" lay-event="edit">修改</a>
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </script>

    <table class="layui-table" id="followTable"  lay-filter="followTable"></table>

    <script type="text/html" id="imgtmp">
        <div class="layer-photos-demo" onclick="img_click()" style="cursor:pointer;">
            <img layer-src="../../images/logo.jpg" src="../../images/logo.jpg" alt="头像图片">
        </div>
    </script>

    <script>
        layui.use(['element', 'table'], function () {
            var $ = layui.jquery,
                element = layui.element,
                table = layui.table;
            table.render({
                elem: "#followTable",
                url: '../../../Goods/findGoods',
                page: true,
                skin: 'row',
                even: true,
                done: function (res, curr, count) { //表格数据加载完后的事件
                    //调用示例
                    layer.photos({//点击图片弹出
                        photos: '.layer-photos-demo'
                        , anim: 1 //0-6的选择，指定弹出图片动画类型，默认随机（请注意，3.0之前的版本用shift参数）
                    });
                    //如果是异步请求数据方式，res即为你接口返回的信息。
                    //如果是直接赋值的方式，res即为：{data: [], count: 99} data为当前页数据、count为数据总长度
                    console.log(res);
                },
                cols: [[
                    {type: 'numbers', width: 80, title: "序号"},
                    {
                        field: "goods_title", title: "商品名称", templet: function (d) {
                            if (d.goods_title.length > 7) {
                                return d.goods_title.substring(0, 7) + '...';
                            } else {
                                return d.goods_title;
                            }
                        }
                    },
                    {
                        field: "goods_sub_title", title: "商品副标题", templet: function (d) {
                            if (d.goods_sub_title.length > 7) {
                                return d.goods_sub_title.substring(0, 7) + '...';
                            } else {
                                return d.goods_sub_title;
                            }
                        }
                    },
                    {field: "goods_sub_title", title: "商品图片", templet: '#imgtmp'},
                    {field: "brand_name", title: "所属品牌"},
                    {field: "goods_price", title: "参考价位", sort: true},
                    {field: "goods_stock", title: "商品库存", sort: true},
                    {field: "status", title: "商品状态", templet: '#state'},
                    {field: 'right', title: '操作', toolbar: '#barDemo'},
                ]]
            });

            //监听行工具事件
            table.on('tool(followTable)', function (obj) { //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
                var data = obj.data //获得当前行数据
                    , layEvent = obj.event; //获得 lay-event 对应的值
                //删除
                if (layEvent === 'del') {
                    layer.confirm('真的要删除么?', function (index) {
                        $.getJSON("/users/back/delUser/" + data.id,
                            function (result) {
                                if (result > 0) {
                                    obj.del(); //删除对应行（tr）的DOM结构，并更新缓
                                    layer.close(index);
                                    layer.msg("删除成功!");
                                } else {
                                    layer.msg("删除失败,请重试!");
                                }
                            });
                        layer.close(index);
                    });
                    //修改
                } else if (layEvent === 'edit') {
                    $.getJSON("/users/back/findById/" + data.id,
                        function (result) {
                            $("#popUpdateTest input[name=id]").val(result.id);
                            $("#popUpdateTest input[name=userName]").val(result.userName);
                            $("input[name=sex][value=" + result.sex + "]").prop("checked", "true");
                            $("#popUpdateTest input[name=birthday]").val(result.birthday);
                            $("#popUpdateTest input[name=phone]").val(result.phone);
                            $("#popUpdateTest input[name=email]").val(result.email);
                            $("#popUpdateTest input[name=time]").val(result.time);
                            $("#popUpdateTest input[name=address]").val(result.address);
                            form.render();  //更新全部
                        });
                    layer.open({
                        //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                        type: 1,
                        title: "修改用户信息",
                        area: ['750px', '480px'],
                        content: $("#popUpdateTest")//引用的弹出层的页面层的方式加载修改界面表单
                    });
                }
            });
        });

    </script>


    <script id="state" type="text/html">
        {{#  if(d.goods_state == 1){ }}
        <span style="color: #f20257;">上架</span>
        {{#  } else { }}
        <span>下架</span>
        {{#  } }}
    </script>
</div>
</body>

</html>